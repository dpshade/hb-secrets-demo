<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HyperBEAM Chat</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Connection Status Header -->
    <div class="connection-header">
        <div class="connection-status">
            <div id="auth-indicator" class="status-indicator offline" role="status" aria-label="Authentication status">
                <span class="status-dot" aria-hidden="true"></span>
                <span id="auth-text">HyperBEAM Disconnected</span>
            </div>
            <div id="user-address" class="user-address hidden"></div>
        </div>
    </div>

    <div class="app-container">
        <!-- Auth Panel (Left) -->
        <div class="auth-builder-panel">
            <div class="panel-header">
                <div class="panel-icon">
                    <svg class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd" />
                    </svg>
                </div>
                <h2>Authentication</h2>
                <button class="configure-btn">Configure</button>
            </div>
            
            <div class="auth-tabs" role="tablist" aria-label="Authentication methods">
                <button class="auth-tab active" data-tab="generate" role="tab" aria-controls="generate-tab" aria-selected="true" tabindex="0">Generate</button>
                <button class="auth-tab" data-tab="import" role="tab" aria-controls="import-tab" aria-selected="false" tabindex="-1">Import</button>
                <button class="auth-tab" data-tab="basic" role="tab" aria-controls="basic-tab" aria-selected="false" tabindex="-1">Basic Auth</button>
                <button class="auth-tab" data-tab="wallets" role="tab" aria-controls="wallets-tab" aria-selected="false" tabindex="-1">Wallets</button>
            </div>

            <div class="auth-tab-content">
                <!-- Generate Wallet Tab -->
                <div id="generate-tab" class="tab-panel active" role="tabpanel" aria-labelledby="generate-tab-button">
                    <div class="auth-welcome">
                        <h3>Generate New Wallet</h3>
                        <p class="auth-description">Create a new wallet for secure authentication</p>
                    </div>
                    
                    <div class="storage-options">
                        <label class="storage-label">Storage Mode:</label>
                        <div class="storage-tabs" role="tablist" aria-label="Storage options">
                            <button class="storage-tab active" data-persist="in-memory" role="tab" aria-selected="true">
                                <div class="storage-tab-content">
                                    <div class="storage-tab-title">Temporary</div>
                                    <div class="storage-tab-desc">Session only</div>
                                </div>
                            </button>
                            <button class="storage-tab" data-persist="client" role="tab" aria-selected="false">
                                <div class="storage-tab-content">
                                    <div class="storage-tab-title">Local</div>
                                    <div class="storage-tab-desc">Browser storage</div>
                                </div>
                            </button>
                            <button class="storage-tab" data-persist="non-volatile" role="tab" aria-selected="false">
                                <div class="storage-tab-content">
                                    <div class="storage-tab-title">Saved</div>
                                    <div class="storage-tab-desc">Server storage</div>
                                </div>
                            </button>
                        </div>
                        <div class="storage-description">
                            <div class="storage-desc-content" data-persist="in-memory">
                                <strong>Temporary:</strong> Wallet lost when session ends.
                            </div>
                            <div class="storage-desc-content hidden" data-persist="client">
                                <strong>Local:</strong> Wallet stored in your browser.
                            </div>
                            <div class="storage-desc-content hidden" data-persist="non-volatile">
                                <strong>Saved:</strong> Wallet stored on server permanently.
                            </div>
                        </div>
                    </div>
                    
                    <button id="generate-wallet-btn" class="btn primary">Generate Wallet</button>
                </div>

                <!-- Import Wallet Tab -->
                <div id="import-tab" class="tab-panel" role="tabpanel" aria-labelledby="import-tab-button">
                    <div class="auth-welcome">
                        <h3>Import Existing Wallet</h3>
                        <p class="auth-description">Import your existing wallet using your private key or mnemonic phrase.</p>
                    </div>
                    
                    <div class="auth-option-card">
                        <div class="option-header">
                            <svg class="option-icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" />
                            </svg>
                            <div class="option-content">
                                <div class="option-title">Import from Private Key</div>
                            </div>
                        </div>
                        <p class="option-description">Enter your existing private key to restore wallet access.</p>
                    </div>
                    
                    <input type="password" id="private-key-input" placeholder="Enter your private key..." />
                    
                    <details class="advanced-options">
                        <summary>Advanced Import Options</summary>
                        <div class="advanced-content">
                            <label for="mnemonic-input">Mnemonic Phrase:</label>
                            <textarea id="mnemonic-input" placeholder="Enter your 12 or 24 word mnemonic phrase..."></textarea>
                            <label for="wallet-json">Wallet JSON (Legacy):</label>
                            <textarea id="wallet-json" placeholder="Paste your wallet JSON data..."></textarea>
                        </div>
                    </details>
                    
                    <button id="import-wallet-btn" class="btn primary">Import Wallet</button>
                </div>

                <!-- Basic Auth Tab -->
                <div id="basic-tab" class="tab-panel" role="tabpanel" aria-labelledby="basic-tab-button">
                    <div class="auth-welcome">
                        <h3>Deterministic Wallet Authentication</h3>
                        <p class="auth-description">Use HTTP Basic Authentication to access your deterministic wallet. Same credentials always generate the same wallet address.</p>
                    </div>
                    
                    <div class="auth-option-card">
                        <div class="option-header">
                            <svg class="option-icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z" />
                            </svg>
                            <div class="option-content">
                                <div class="option-title">Deterministic Wallet Access</div>
                            </div>
                        </div>
                        <p class="option-description">Your credentials are used with PBKDF2 key derivation to deterministically generate the same wallet every time. No wallet files needed.</p>
                    </div>
                    
                    <input type="text" id="username-input" placeholder="Username" />
                    <input type="password" id="password-input" placeholder="Password" />
                    
                    <button id="basic-auth-btn" class="btn primary">Connect</button>
                </div>

                <!-- Wallets Tab -->
                <div id="wallets-tab" class="tab-panel" role="tabpanel" aria-labelledby="wallets-tab-button">
                    <div class="auth-welcome">
                        <h3>Manage Stored Wallets</h3>
                        <p class="auth-description">View and manage wallets stored on the HyperBEAM node. Export, sync, or switch between different wallets.</p>
                    </div>
                    
                    <div class="wallet-actions">
                        <button id="refresh-wallets-btn" class="btn secondary small">Refresh List</button>
                        <button id="export-wallets-btn" class="btn secondary small">Export All</button>
                        <button id="sync-wallets-btn" class="btn secondary small">Sync from Peer</button>
                    </div>
                    
                    <div id="wallets-loading" class="wallets-loading hidden">
                        <div class="loading-spinner"></div>
                        <span>Loading wallets...</span>
                    </div>
                    
                    <div id="wallets-list" class="wallets-list">
                        <div class="no-wallets-message">
                            <p>No stored wallets found. Generate or import a wallet to get started.</p>
                        </div>
                    </div>
                    
                    <div class="sync-options" style="display: none;">
                        <details class="advanced-options">
                            <summary>Sync from Peer Node</summary>
                            <div class="advanced-content">
                                <label for="peer-node-input">Peer Node URL:</label>
                                <input type="url" id="peer-node-input" placeholder="https://peer.hyperbeam.network" />
                                <button id="sync-from-peer-btn" class="btn primary">Sync Wallets</button>
                            </div>
                        </details>
                    </div>
                </div>
            </div>

            <!-- Connected Summary (shown when authenticated) -->
            <div class="connected-summary">
                <div class="status-indicator online">
                    <span class="status-dot"></span>
                    <span>Connected</span>
                </div>
                <div class="user-info">
                    <div class="label">Wallet Address</div>
                    <div class="value" id="connected-address"></div>
                </div>
                <button id="connected-disconnect-btn" class="btn danger small">Disconnect</button>
            </div>
        </div>

        <!-- Chat Panel (Right) -->
        <div class="chat-panel">
            <div class="panel-header">
                <div class="panel-icon">
                    <svg class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd" />
                    </svg>
                </div>
                <h2>HyperBEAM Chat</h2>
                <div class="chat-tabs" role="tablist" aria-label="Chat view options">
                    <button class="chat-tab active" role="tab" aria-selected="true">Messages</button>
                    <button class="chat-tab" role="tab" aria-selected="false">Users</button>
                    <button class="chat-tab" role="tab" aria-selected="false">Settings</button>
                </div>
            </div>

            <div class="chat-status-banner" role="status" aria-live="polite">
                <span class="status-dot online" aria-hidden="true"></span>
                <span>Connected to HyperBEAM Network</span>
            </div>

            <!-- Chat Interface -->
            <div id="chat-interface" class="chat-interface hidden">
                <div id="messages-container" class="messages-container" role="log" aria-live="polite" aria-label="Chat messages">
                    <div class="message-loading">Loading messages...</div>
                </div>

                <div class="message-input-container">
                    <div class="input-group">
                        <input type="text" id="message-input" placeholder="Type your message..." maxlength="500" aria-label="Message input" aria-describedby="char-count">
                        <button id="send-btn" class="btn primary send-btn">Send</button>
                    </div>
                    <div class="input-info">
                        <span id="char-count" aria-live="polite">0/500</span>
                        <button id="disconnect-btn" class="btn danger small">Disconnect</button>
                    </div>
                </div>
            </div>

            <!-- Welcome State -->
            <div id="welcome-state" class="welcome-state">
                <div class="system-badge">SYSTEM</div>
                <div class="system-ready">Ready</div>
                <div class="welcome-content">
                    <div class="welcome-icon">
                        <svg class="w-8 h-8" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2L13.09 8.26L22 9L13.09 9.74L12 16L10.91 9.74L2 9L10.91 8.26L12 2Z" />
                        </svg>
                    </div>
                    <p>Welcome to HyperBEAM Chat! Join the decentralized conversation where your messages are cryptographically signed and permanent.</p>
                    <p>Choose an authentication method on the left to start chatting!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Messages -->
    <div id="status-messages" class="status-messages"></div>

    <!-- Configuration -->
    <script src="config.js"></script>
    
    <!-- Core Scripts -->
    <script src="js/hyperbeam-api.js"></script>
    <script src="js/auth.js"></script>  
    <script src="js/chat.js"></script>
    <script src="js/ui-tabs.js"></script>

    <script>
        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize authentication system
            Auth.init();
            
            // Initialize chat system
            Chat.init();
            
            console.log('HyperBEAM Chat initialized');
        });
    </script>
</body>
</html>